<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Receta Médica - Generador</title>
  <style>
    /* Layout general */
    :root{
      --accent:#2b5f9e;
      --muted:#6b7280;
      --card:#ffffff;
      --bg:#f4f6fb;
      --danger:#e85a5a;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, var(--bg), #eef2fb 120%);
      color:#111827;
    }

    .app {
      max-width:1100px;
      margin:28px auto;
      padding:22px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:18px;
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo {
      width:56px;
      height:56px;
      background:linear-gradient(135deg,var(--accent),#46a6d6);
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:white;
      font-weight:700;
      font-size:20px;
      box-shadow:0 6px 18px rgba(43,95,158,0.12);
    }

    h1{ margin:0; font-size:20px; }
    p.lead { margin:0; color:var(--muted); font-size:13px; }

    /* Grid */
    .grid {
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:18px;
    }

    @media (max-width:980px){
      .grid { grid-template-columns: 1fr; }
    }

    /* Card */
    .card {
      background:var(--card);
      border-radius:12px;
      padding:16px;
      box-shadow: 0 6px 18px rgba(16,24,40,0.06);
    }

    .section-title {
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:12px;
    }
    .section-title h2 { margin:0; font-size:16px; }
    .small { font-size:13px; color:var(--muted); }

    /* Form rows */
    .form-row {
      display:flex;
      gap:12px;
      margin-bottom:10px;
      align-items:stretch;
    }
    .form-row > div { flex:1; }
    .form-row .w-120 { width:120px; flex:0 0 120px; }
    .form-row .w-80 { width:80px; flex:0 0 80px; }

    label { display:block; margin-bottom:6px; font-size:13px; color:var(--muted); }
    /* intentionally NO styles for input, textarea, select as requested */

    /* Buttons */
    .btn {
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:8px;
      border:0;
      background:var(--accent);
      color:white;
      cursor:pointer;
      font-weight:600;
      box-shadow:0 6px 12px rgba(43,95,158,0.12);
    }
    .btn.ghost {
      background:transparent;
      color:var(--accent);
      border:1px solid rgba(43,95,158,0.12);
      box-shadow:none;
    }
    .btn.warn { background:var(--danger); }

    /* Prescription list */
    .rx-list { display:flex; flex-direction:column; gap:10px; margin-top:8px; }
    .rx-item {
      border:1px dashed rgba(15,23,42,0.06);
      border-radius:10px;
      padding:10px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .rx-item .info { flex:1; }
    .rx-item .meta { text-align:right; flex:0 0 140px; color:var(--muted); font-size:13px; }

    .actions { display:flex; gap:8px; align-items:center; }

    /* Preview area */
    .preview {
      min-height:120px;
      border-radius:10px;
      padding:14px;
      background: linear-gradient(180deg,#ffffff,#fbfdff);
      border:1px solid rgba(16,24,40,0.04);
    }

    .preview header {
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .clinic { font-weight:700; font-size:16px; }
    .meta-sm { color:var(--muted); font-size:12px; }

    /* Printable layout tweaks */
    @media print {
      body { background: white; }
      .app { margin:0; padding:0; max-width: 100%;}
      header, .btn, .actions { display:none !important; }
      .card { box-shadow:none; border-radius:0; padding:0; }
    }

    /* small helpers */
    .muted { color:var(--muted); font-size:13px; }
    .space-top { margin-top:12px; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">Rx</div>
        <div>
          <h1>Generador de Receta Médica</h1>
          <p class="lead">Completa los datos y agrega medicamentos. Vista lista para imprimir.</p>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;">
        <button class="btn" id="btn-print" title="Imprimir receta">Imprimir</button>
        <button class="btn ghost" id="btn-reset">Limpiar</button>
      </div>
    </header>

    <div class="grid">
      <!-- Left column: formulario y lista -->
      <div>
        <div class="card">
          <div class="section-title">
            <h2>Datos del paciente / consulta</h2>
            <div class="small">Llena los campos básicos</div>
          </div>

          <div class="form-row">
            <div>
              <label for="patient-name">Nombre del paciente</label>
              <input id="patient-name" type="text" placeholder="Ej. Juan Pérez" />
            </div>
            <div class="w-120">
              <label for="patient-age">Edad</label>
              <input id="patient-age" type="text" placeholder="Ej. 34" />
            </div>
            <div class="w-120">
              <label for="patient-sex">Sexo</label>
              <select id="patient-sex">
                <option value="">--</option>
                <option>Masculino</option>
                <option>Femenino</option>
                <option>Otro</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div>
              <label for="doctor-name">Doctor(a)</label>
              <input id="doctor-name" type="text" placeholder="Nombre del médico" />
            </div>
            <div class="w-120">
              <label for="doctor-lic">Cédula / RFC</label>
              <input id="doctor-lic" type="text" placeholder="Número" />
            </div>
            <div class="w-120">
              <label for="date">Fecha</label>
              <input id="date" type="date" />
            </div>
          </div>

          <div style="margin-top:10px;">
            <label for="consulta-notes">Notas de consulta / diagnóstico</label>
            <textarea id="consulta-notes" rows="3" placeholder="Observaciones, alergias, antecedente relevante..."></textarea>
          </div>
        </div>

        <div class="card space-top">
          <div class="section-title">
            <h2>Agregar medicamento</h2>
            <div class="small">Nombre, dosis, vía, frecuencia, duración y cantidad</div>
          </div>

          <div id="med-form">
            <div class="form-row">
              <div>
                <label for="med-name">Medicamento</label>
                <input id="med-name" type="text" placeholder="Ej. Amoxicilina" />
              </div>
              <div class="w-120">
                <label for="med-dosis">Dosis</label>
                <input id="med-dosis" type="text" placeholder="Ej. 500 mg" />
              </div>
              <div class="w-120">
                <label for="med-via">Vía</label>
                <select id="med-via">
                  <option value="">--</option>
                  <option>Oral</option>
                  <option>Intravenosa</option>
                  <option>Intramuscular</option>
                  <option>Tópica</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div>
                <label for="med-freq">Frecuencia / indicaciones</label>
                <input id="med-freq" type="text" placeholder="Ej. 1 cada 8 horas" />
              </div>
              <div class="w-120">
                <label for="med-duration">Duración</label>
                <input id="med-duration" type="text" placeholder="Ej. 7 días" />
              </div>
              <div class="w-80">
                <label for="med-qty">Cantidad</label>
                <input id="med-qty" type="number" placeholder="Ej. 21" />
              </div>
            </div>

            <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
              <button class="btn" id="btn-add">Agregar medicamento</button>
              <button class="btn ghost" id="btn-clear-med">Limpiar campos</button>
              <div style="margin-left:auto" class="muted">Puedes editar cada medicamento en la lista.</div>
            </div>
          </div>
        </div>

        <div class="card space-top">
          <div class="section-title">
            <h2>Listado de medicamentos</h2>
            <div class="small">Click en editar para modificar o eliminar</div>
          </div>

          <div id="rx-list" class="rx-list">
            <div class="muted">No hay medicamentos agregados.</div>
          </div>
        </div>
      </div>

      <!-- Right column: preview e indicaciones -->
      <aside>
        <div class="card">
          <div class="section-title">
            <h2>Preview de la receta</h2>
            <div class="small">Ajusta los datos antes de imprimir</div>
          </div>

          <div id="preview" class="preview" aria-live="polite">
            <header>
              <div>
                <div class="clinic" id="preview-doctor">Doctor / Clínica</div>
                <div class="meta-sm" id="preview-docid">Cédula: -</div>
              </div>
              <div style="text-align:right;">
                <div id="preview-date">Fecha: -</div>
                <div class="meta-sm" id="preview-patient">Paciente: -</div>
              </div>
            </header>

            <hr style="border:none;border-top:1px solid rgba(16,24,40,0.06);margin:10px 0;">

            <div id="preview-diagnosis" class="muted">Diagnóstico / notas: -</div>

            <div id="preview-rx" style="margin-top:12px;">
              <strong>Receta:</strong>
              <ol id="preview-rx-list" style="padding-left:18px;margin-top:6px;color:#111827;"></ol>
            </div>

            <div style="margin-top:12px;">
              <strong>Indicaciones generales:</strong>
              <div id="preview-indic" class="muted" style="margin-top:6px;">Tiempo de consumo: -</div>
            </div>

            <div style="margin-top:14px;text-align:right;color:var(--muted);font-size:13px;">
              Firma: _______________________________
            </div>
          </div>
        </div>

        <div class="card space-top">
          <div class="section-title">
            <h2>Indicaciones y tiempo</h2>
            <div class="small">Información adicional</div>
          </div>

          <div>
            <label for="tiempo-consumo">Tiempo de consumo / observaciones</label>
            <input id="tiempo-consumo" type="text" placeholder="Ej. Tomar con alimentos; no conducir" />
          </div>

          <div style="margin-top:10px;">
            <label for="prescription-notes">Notas visibles en la receta</label>
            <textarea id="prescription-notes" rows="3" placeholder="Instrucciones adicionales que aparecerán en la receta."></textarea>
          </div>

          <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end;">
            <button class="btn" id="btn-save-pdf" disabled>Guardar (PDF) — opcional</button>
            <button class="btn ghost" id="btn-export-json">Exportar JSON</button>
          </div>
        </div>

      </aside>
    </div>
  </div>

  <script>
    // Estado básico
    const state = {
      meds: []
    };

    // DOM refs
    const rxListEl = document.getElementById('rx-list');
    const previewRxList = document.getElementById('preview-rx-list');
    const previewDoctor = document.getElementById('preview-doctor');
    const previewDocId = document.getElementById('preview-docid');
    const previewDate = document.getElementById('preview-date');
    const previewPatient = document.getElementById('preview-patient');
    const previewDiag = document.getElementById('preview-diagnosis');
    const previewIndic = document.getElementById('preview-indic');

    const inputs = {
      patientName: document.getElementById('patient-name'),
      patientAge: document.getElementById('patient-age'),
      patientSex: document.getElementById('patient-sex'),
      doctorName: document.getElementById('doctor-name'),
      doctorLic: document.getElementById('doctor-lic'),
      date: document.getElementById('date'),
      consultaNotes: document.getElementById('consulta-notes'),
      tiempoConsumo: document.getElementById('tiempo-consumo'),
      prescriptionNotes: document.getElementById('prescription-notes'),

      // med inputs
      medName: document.getElementById('med-name'),
      medDosis: document.getElementById('med-dosis'),
      medVia: document.getElementById('med-via'),
      medFreq: document.getElementById('med-freq'),
      medDuration: document.getElementById('med-duration'),
      medQty: document.getElementById('med-qty'),
    };

    // Buttons
    const btnAdd = document.getElementById('btn-add');
    const btnClearMed = document.getElementById('btn-clear-med');
    const btnReset = document.getElementById('btn-reset');
    const btnPrint = document.getElementById('btn-print');
    const btnExportJson = document.getElementById('btn-export-json');

    // Util: render list
    function renderMeds(){
      rxListEl.innerHTML = '';
      if(state.meds.length === 0){
        rxListEl.innerHTML = '<div class="muted">No hay medicamentos agregados.</div>';
      } else {
        state.meds.forEach((m, idx) => {
          const item = document.createElement('div');
          item.className = 'rx-item';
          item.innerHTML = `
            <div class="info">
              <strong>${escapeHtml(m.name || '—')}</strong>
              <div class="muted" style="margin-top:6px;">
                ${escapeHtml(m.dosis || '')} · ${escapeHtml(m.via || '')} · ${escapeHtml(m.freq || '')}
                ${m.duration ? '· ' + escapeHtml(m.duration) : ''}
              </div>
              ${m.notes ? `<div style="margin-top:6px;font-size:13px;color:var(--muted)">${escapeHtml(m.notes)}</div>` : ''}
            </div>
            <div class="meta">
              <div>Cantidad: <strong>${escapeHtml(String(m.qty || '-'))}</strong></div>
              <div style="margin-top:8px" class="actions">
                <button class="btn ghost" data-action="edit" data-idx="${idx}">Editar</button>
                <button class="btn warn" data-action="del" data-idx="${idx}">Eliminar</button>
              </div>
            </div>
          `;
          rxListEl.appendChild(item);
        });
      }

      // preview
      renderPreview();
    }

    function renderPreview(){
      // doctor/patient meta
      previewDoctor.textContent = inputs.doctorName.value || 'Doctor / Clínica';
      previewDocId.textContent = 'Cédula: ' + (inputs.doctorLic.value || '-');
      previewDate.textContent = 'Fecha: ' + (inputs.date.value || new Date().toLocaleDateString());
      previewPatient.textContent = 'Paciente: ' + (inputs.patientName.value || '-');

      previewDiag.textContent = inputs.consultaNotes.value || '-';
      previewIndic.textContent = (inputs.tiempoConsumo.value || '-') + (inputs.prescriptionNotes.value ? ' — ' + inputs.prescriptionNotes.value : '');

      // rx list
      previewRxList.innerHTML = '';
      if(state.meds.length === 0){
        const li = document.createElement('li');
        li.textContent = '(Sin medicamentos)';
        previewRxList.appendChild(li);
      } else {
        state.meds.forEach(m => {
          const li = document.createElement('li');
          li.textContent = `${m.name || '-'}: ${m.dosis || ''} ${m.via ? '('+m.via+')':''} — ${m.freq || ''} ${m.duration ? '· ' + m.duration : ''} ${m.qty ? '· Cant: ' + m.qty : ''}`;
          previewRxList.appendChild(li);
        });
      }
    }

    // Add med
    btnAdd.addEventListener('click', (e) => {
      e.preventDefault();
      const med = {
        name: inputs.medName.value.trim(),
        dosis: inputs.medDosis.value.trim(),
        via: inputs.medVia.value,
        freq: inputs.medFreq.value.trim(),
        duration: inputs.medDuration.value.trim(),
        qty: inputs.medQty.value ? Number(inputs.medQty.value) : '',
        notes: ''
      };

      if(!med.name){
        alert('Por favor ingresa el nombre del medicamento.');
        return;
      }

      state.meds.push(med);
      clearMedFields();
      renderMeds();
    });

    // Clear med form
    btnClearMed.addEventListener('click', (e) => {
      e.preventDefault();
      clearMedFields();
    });

    // Reset all
    btnReset.addEventListener('click', (e) => {
      e.preventDefault();
      if(!confirm('Limpiar todos los datos de la receta?')) return;
      // clear inputs and state
      Object.values(inputs).forEach(inp => {
        if(inp.tagName === 'SELECT') inp.selectedIndex = 0;
        else if(inp.tagName === 'TEXTAREA' || inp.tagName === 'INPUT') inp.value = '';
      });
      state.meds = [];
      renderMeds();
    });

    // Delegación para editar / eliminar meds
    rxListEl.addEventListener('click', (ev) => {
      const btn = ev.target.closest('button');
      if(!btn) return;
      const action = btn.dataset.action;
      const idx = Number(btn.dataset.idx);
      if(action === 'del'){
        if(confirm('Eliminar medicamento?')){
          state.meds.splice(idx,1);
          renderMeds();
        }
      } else if(action === 'edit'){
        const m = state.meds[idx];
        // cargar en el formulario para editar (simple: reemplaza y borra original)
        inputs.medName.value = m.name;
        inputs.medDosis.value = m.dosis;
        inputs.medVia.value = m.via;
        inputs.medFreq.value = m.freq;
        inputs.medDuration.value = m.duration;
        inputs.medQty.value = m.qty;
        // remove original
        state.meds.splice(idx,1);
        renderMeds();
        // focus
        inputs.medName.focus();
      }
    });

    // Print
    btnPrint.addEventListener('click', () => {
      // before print, update preview
      renderPreview();
      window.print();
    });

    // Export JSON
    btnExportJson.addEventListener('click', () => {
      const payload = {
        paciente: {
          nombre: inputs.patientName.value,
          edad: inputs.patientAge.value,
          sexo: inputs.patientSex.value
        },
        doctor: {
          nombre: inputs.doctorName.value,
          cedula: inputs.doctorLic.value
        },
        fecha: inputs.date.value || new Date().toISOString().slice(0,10),
        consultaNotas: inputs.consultaNotes.value,
        tiempoConsumo: inputs.tiempoConsumo.value,
        prescriptionNotes: inputs.prescriptionNotes.value,
        medicamentos: state.meds
      };
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(payload, null, 2));
      const dl = document.createElement('a');
      dl.setAttribute('href', dataStr);
      dl.setAttribute('download', `receta_${(payload.paciente.nombre||'sin_nombre').replace(/\s+/g,'_')}.json`);
      document.body.appendChild(dl);
      dl.click();
      dl.remove();
    });

    // Small helpers
    function clearMedFields(){
      inputs.medName.value = '';
      inputs.medDosis.value = '';
      inputs.medVia.selectedIndex = 0;
      inputs.medFreq.value = '';
      inputs.medDuration.value = '';
      inputs.medQty.value = '';
    }

    function escapeHtml(str){
      if(!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // Keep preview synced when meta fields change
    ['input','change'].forEach(evt => {
      ['patient-name','doctor-name','doctor-lic','date','consulta-notes','tiempo-consumo','prescription-notes'].forEach(id => {
        const el = document.getElementById(id);
        if(el) el.addEventListener(evt, renderPreview);
      });
    });

    // init
    (function(){
      // set default date
      const d = new Date().toISOString().slice(0,10);
      if(!inputs.date.value) inputs.date.value = d;
      renderMeds();
    })();
  </script>
</body>
</html>
