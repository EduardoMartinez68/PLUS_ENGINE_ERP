{% load static %}
<style>
/* ===== CONTENEDORES PRINCIPALES ===== */
.container-theen {
  display: flex;
  flex: 1;
  overflow: hidden;
  height: 100vh;
  /*background: #f7fafc;*/
}

.odontograma {
  flex: 2;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 30px;
  padding: 20px;
  /*background: white;*/
  border-right: 2px solid #ddd;
}

.arcada {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  gap: 8px;
  padding-bottom: 10px;
  justify-content: center;
}

.arcada-inferior {
  transform: rotate(180deg);
}

/* ===== DIENTE ===== */
.diente {
  min-width: 65px;
  min-height: 95px;
  background: #e2e8f0;
  border: 2px solid #718096;
  border-radius: 6px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-end;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s ease;
  flex-shrink: 0;
  padding-top: 5px;
  position: relative;
}

.diente:hover {
  background: #bee3f8;
}

.diente.activo {
  background: #63b3ed;
  color: white;
  border-color: #2b6cb0;
}

/* ===== NÚMERO DE DIENTE ===== */
.numero-diente {
  position: absolute;
  top: 3px;
  font-size: 0.9rem;
  color: #757575;
  font-weight: bold;
}

.arcada-inferior .numero-diente {
  transform: rotate(180deg);
}

/* ===== PANEL INFO ===== */
.panel-info {
  flex: 1;
  padding: 20px;
  /*background: #edf2f7;*/
  transition: transform 0.3s ease;
  overflow-y: auto;
  width: 500px;
}

.panel-info h2 { margin-top: 0; }
.panel-info.hidden { display: none; }

/* ===== DIBUJOS DE DIENTES ===== */
.diente-container {
  width: 40px;
  aspect-ratio: 150 / 200; /* ancho / alto según viewBox */
  display: flex;
  align-items: center;
  justify-content: center;
}


.diente-container svg {
  width: 100%;
  height: 100%;
  display: block;
  transform-origin: center bottom; /* centra el diente */
}



/*----------------------------------------------------------------------------------info theen----------------------------------------------------------------*/
.info-diente {
  padding: 1rem;
  font-family: 'Segoe UI', sans-serif;
  color: #333;
}

.titulo-info {
  text-align: center;
  margin-bottom: 1rem;
  font-size: 1.4rem;
  color: #2d2d2d;
}

/* ======== ESQUEMA DENTAL CIRCULAR ======== */
.esquema-diente-circular {
  position: relative;
  width: 180px;
  height: 180px;
  margin: 0 auto 1.2rem;
  border-radius: 50%;
  background: #f8f8f8;
  border: 3px solid #ccc;
  overflow: hidden;
  box-shadow: 0 0 6px rgba(0,0,0,0.1);
  display: flex;
  justify-content: center;
  align-items: center;
}

/* Cuadrantes (4 partes) */
.cuadrante {
  position: absolute;
  width: 50%;
  height: 50%;
  background: #ffffff;
  border: 1px solid #ddd;
  transition: background 0.3s, transform 0.2s;
}

/* Posiciones */
[data-cara="superior-izq"] {
  top: 0; left: 0;
  border-top-left-radius: 100%;
}
[data-cara="superior-der"] {
  top: 0; right: 0;
  border-top-right-radius: 100%;
}
[data-cara="inferior-izq"] {
  bottom: 0; left: 0;
  border-bottom-left-radius: 100%;
}
[data-cara="inferior-der"] {
  bottom: 0; right: 0;
  border-bottom-right-radius: 100%;
}

/* Centro (oclusal) */
.centro {
  width: 40%;
  height: 40%;
  background: #fff;
  border: 2px solid #bbb;
  border-radius: 50%;
  z-index: 2;
  transition: background 0.3s, transform 0.2s;
}

/* Interacción visual */
.cara:hover {
  background: #e6f0ff;
  cursor: pointer;
  transform: scale(1.03);
}
.cara.activa {
  background: #63a4ff;
  border-color: #4a90e2;
}

/* ====== Estado general y observaciones ====== */
.estado-general, .info-detallada {
  margin-top: 1rem;
}

.select-estado {
  width: 100%;
  padding: 6px;
  border-radius: 4px;
  border: 1px solid #ccc;
}

/**--------------------------------------------------------------------------caries----------------------------------------------------------**/
.esquema-caries-rect {
  margin: 20px 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.caries-barra {
  display: flex;
  flex-direction: column-reverse;
  width: 50px;
  height: 220px;
  border: 2px solid #cbd5e1;
  border-radius: 12px;
  overflow: hidden;
  background: #f8fafc;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
}

.caries-nivel {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  font-weight: 500;
  color: #fff;
  cursor: pointer;
  transition: all 0.3s ease;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  text-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

/* Colores por profundidad: de blanco (superficial) a negro (pulpar) */
.caries-nivel[data-nivel="superficial"] { 
  background: #ffffff;
  color: #000; /* texto visible */
}
.caries-nivel[data-nivel="media"] { 
  background: #d3d3d3;
}
.caries-nivel[data-nivel="profunda"] { 
  background: #a0a0a0;
}
.caries-nivel[data-nivel="pulpar"] { 
  background: #8b8b8b;
}

/* Nivel seleccionado */
.caries-nivel.activa {
  background: #f56565; /* Color de la capa seleccionada */
  color: #fff;
}

/* Capas por debajo de la seleccionadas (infectadas) */
.caries-nivel.infectada {
  background: #a0aec0; /* Gris simulando daño / hueso afectado */
  color: #fff;
}
</style>


<div class="container-theen">
  <div class="odontograma" id="odontograma">
    <div class="arcada" id="arcada-superior"></div>
    <div class="arcada arcada-inferior" id="arcada-inferior"></div>
  </div>
  <div class="panel-info" id="panel-info">
    <img src="{% static 'img/theen.webp' %}" alt="" style="width: 100%; height: auto;">
    <center><label t="medical-history.label.select-a-tooth"></p></center>
  </div>
</div>

<script>
(()=>{
const dientes = Array.from({ length: 32 }, (_, i) => ({
  id: i + 1,
  nombre: `Diente ${i + 1}`,
  descripcion: `Descripción del diente ${i + 1}. Aquí puedes agregar información sobre su estado clínico, observaciones o tratamientos.`
}));
var colorsTheens={
  theen:'white',
  colorBorder: '#C2C2C2',
  bone_theen: '#F5F3F4',
  bone_blak_theen: '#F4F2F3'
}



function get_svg_activity(activity, x=64, y=181, r=15){
    const activityTheenh={
        "corona":`
            <circle cx="${x}" cy="${y}" r="${r}" fill="none" stroke="#8BB0D1" stroke-width="2"/>
            <circle cx="${x}" cy="${y}" r="${r}" fill="rgba(80,134,214,0.3)" stroke="#8BB0D1" stroke-width="2"/>
        `,
        "coronaProvisional":`
            <circle cx="${x}" cy="${y}" r="${r}" fill="none" stroke="#8BB0D1" stroke-width="2"/>
            <circle cx="${x}" cy="${y}" r="${r}" fill="rgba(80,134,214,0.3)" stroke="#8BB0D1" stroke-width="2"/>
            <text cx="${x}" cy="${y}" text-anchor="middle" dominant-baseline="middle" fill="#085DA8" font-size="12" font-weight="bold">X</text>
        `,
        "coronaMalEstado":`
            <circle cx="${x}" cy="${y}" r="${r}" fill="none" stroke="#FF5656" stroke-width="2"/>
            <circle cx="${x}" cy="${y}" r="${r}" fill="rgba(255,86,86,0.3)" stroke="#FF5656" stroke-width="2"/>
        `,
        "coronaMalEstadoProvisional":`
            <circle cx="${x}" cy="${y}" r="${r}" fill="none" stroke="#FF5656" stroke-width="2"/>
            <circle cx="${x}" cy="${y}" r="${r}" fill="rgba(255,86,86,0.3)" stroke="#FF5656" stroke-width="2"/>
            <text cx="${x}" cy="${y}" text-anchor="middle" dominant-baseline="middle" fill="#FF5656" font-size="12" font-weight="bold">X</text>
        `,


        "restauracion":`
            <circle cx="${x}" cy="${y+3}" r="5" fill="#8BB0D1" stroke="#8BB0D1" stroke-width="2"/>
        `,
        "restauracionMalEstado":`
            <circle cx="${x}" cy="${y+3}" r="5" fill="#FF5656" stroke="#FF5656" stroke-width="2"/>
        `,

        "endodoncia":`
            <line x1="${x}" y1="${y}" x2="${x}" y2="${y+30}" stroke="#8BB0D1" stroke-width="2"/>
        `,
        "endodonciaMalEstado":`
            <line x1="${x}" y1="${y}" x2="${x}" y2="${y+30}" stroke="#8BB0D1" stroke-width="2"/>
            <circle cx="${x}" cy="${y-5}" r="12" fill="none" stroke="#FF5656" stroke-width="2" stroke-dasharray="4,4"/>
        `,


        "implante":`
            <circle cx="${x}" cy="${y}" r="5" fill="#8BB0D1" stroke="#8BB0D1" stroke-width="2"/>
            <line x1="${x}" y1="${y}" x2="${x}" y2="${y-21}" stroke="#8BB0D1" stroke-width="2"/>
        `,

        "implanteMalEstado":`
            <text cx="${x}" cy="${y}" text-anchor="middle" dominant-baseline="middle" fill="#FF5656" font-size="12" font-weight="bold">X</text>
            <circle cx="${x}" cy="${y}" r="5" fill="#8BB0D1" stroke="#8BB0D1" stroke-width="2"/>
            <line x1="${x}" y1="${y}" x2="${x}" y2="${y-21}" stroke="#8BB0D1" stroke-width="2"/>
            <circle cx="${x}" cy="${y-5}" r="12" fill="none" stroke="#FF5656" stroke-width="2" stroke-dasharray="4,4"/>
        `,

        "perno":`
            <circle cx="${x}" cy="${y+3}" r="5" fill="#8BB0D1" stroke="#8BB0D1" stroke-width="2"/>
            <line x1="${x}" y1="${y+3-14}" x2="${x}" y2="${y+10}" stroke="gray" stroke-width="4"/>
        `,
        "pernoMalEstado":`
            <circle cx="${x}" cy="${y+3}" r="5" fill="#FF5656" stroke="#FF5656" stroke-width="2"/>
            <line x1="${x}" y1="${y+3-14}" x2="${x}" y2="${y+10}" stroke="gray" stroke-width="4"/>
        `,

        "protesisRemovible":`
            <circle cx="${x}" cy="${y+4}" r="15" fill="none" stroke="#FFA500" stroke-width="2" stroke-dasharray="4,4"/>
            <text x="${x}" y="${y+4}" text-anchor="middle" dominant-baseline="middle" fill="#FFA500" font-size="12" font-weight="bold">X</text>
        `,

        "amalgama":`
            <rect x="${x-3}" y="${y-10}" width="8" height="6" rx="1" ry="1" fill="#666" stroke="#444" stroke-width="0.5"/>
        `,
        "amalgamaMalEstado":`
            <circle cx="${x}" cy="${y-5}" r="12" fill="none" stroke="#FF5656" stroke-width="2" stroke-dasharray="4,4"/>
            <rect x="${x-3}" y="${y-10}" width="8" height="6" rx="1" ry="1" fill="#666" stroke="#444" stroke-width="0.5"/>
        `,

        "sellante": `
        <!-- Sellante: rectángulo translúcido sobre superficie -->
        <rect x="${x-9}" y="${y}" width="19" height="9" rx="1" ry="2"
                fill="rgba(135,206,235,0.4)" stroke="#87CEEB" stroke-width="1"/>
        `
    }


    return activityTheenh[activity] || "";
}

//this is the format basic of the first 9 theen of the pacient
//this theens are use for create all the patient's jaw
const svgsDientesPruebas = {
  1: `
<svg viewBox="45 135 38 64" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
        d="M64.2753 147.424C57.2797 136.22 54.1597 134.335 54.9151 141.769C55.6706 149.204 57.858 157.283 61.4771 166.007L66.8019 167.199L70.9184 160.346L67.6591 149.881L64.2753 147.424Z"
        fill="${colorsTheens.bone_blak_theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
  <path fill-rule="evenodd" clip-rule="evenodd"
        d="M76.1241 179.29C76.29 170.334 75.6195 163.229 74.1125 157.976C72.005 150.629 69.6182 147.062 68.0683 145.18C66.5183 143.297 62.8123 140.555 63.1369 144.517C63.3002 146.511 65.0562 150.757 65.5166 154.789C66.0671 159.611 65.2726 164.128 64.5919 164.128C63.2123 164.128 63.8894 156.31 61.4425 149.823C59.3798 144.355 54.5071 140.092 52.1722 140.356C49.8373 140.62 54.0026 150.608 53.9575 157.499C53.9039 165.678 53.7485 174.181 53.0546 176.484C52.0879 179.69 59.7777 180.626 76.1241 179.29Z"
        fill="${colorsTheens.bone_theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
  <path fill-rule="evenodd" clip-rule="evenodd"
        d="M57.1449 173.704C60.9228 171.63 65.6902 170.717 70.5069 173.704C75.3237 176.691 77.6012 181.331 78.0033 184.465C78.1894 185.916 78.8645 190.748 74.2745 193.275C71.4811 194.812 67.6431 192.727 66.4252 191.74C65.2073 190.753 63.1025 189.242 60.7782 191.74C58.4539 194.237 55.4549 192.252 54.445 191.352C53.4352 190.453 50.8711 188.224 50.8711 184.22C50.8711 180.215 52.1565 176.444 57.1449 173.704Z"
        fill="${colorsTheens.theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />

    ${get_svg_activity("endodonciaMalEstado")}

</svg>`,

  2: `
<svg viewBox="90 130 40 70" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
        d="M108.416 138.753C108.283 137.579 107.978 136.557 107.5 135.684C106.783 134.375 102.776 127.124 101.355 136.256C100.408 142.344 100.408 146.372 101.355 148.342L105.485 167.307L111.951 168.101L114.562 154.346L108.416 138.753Z"
        fill="${colorsTheens.bone_blak_theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
  <path fill-rule="evenodd" clip-rule="evenodd"
        d="M123.276 184.088C121.656 173.159 120.844 165.162 120.842 160.097C120.838 152.5 116.607 143.84 113.721 139.943C110.835 136.045 107.964 133.804 107.516 137.732C107.268 139.9 110.026 146.895 110.622 154.02C110.85 156.748 111.137 157.224 111.026 161.519C110.915 165.814 108.393 166.05 107.331 161.639C106.992 160.226 105.417 154.765 105.122 149.234C104.865 144.411 105.122 140.88 104.576 138.755C103.689 135.302 100.945 136.867 99.851 138.171C96.2196 142.499 95.6317 151.156 96.421 158.922C97.2103 166.688 98.0414 170.911 97.413 180.877C96.994 187.521 105.615 188.592 123.276 184.088Z"
        fill="${colorsTheens.bone_theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
  <path fill-rule="evenodd" clip-rule="evenodd"
        d="M123.944 186.594C124.135 188.07 124.021 194.834 119.32 197.405C116.459 198.97 112.126 196.848 110.878 195.843C109.631 194.839 108.303 193.477 104.289 195.228C101.369 196.502 98.0319 193.492 96.9978 192.577C96.483 192.122 94.1719 188.087 94.9157 184.116C95.6661 180.109 99.4844 176.163 101.893 175.325C104.869 174.289 105.963 175.863 110.367 176.081C113.201 176.221 115.256 175.59 117.625 176.551C123.01 178.736 123.893 186.195 123.944 186.594Z"
        fill="${colorsTheens.theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />


</svg>`,

  3: `
<svg viewBox="135 135 40 70" xmlns="http://www.w3.org/2000/svg">
        <path
            d="M130.715 256.054H129.244V257.525H130.715V256.054ZM174.852 254.583H130.715V257.525H174.852V254.583ZM132.186 256.054V88.3348H129.244V256.054H132.186Z"
            fill="#F2F2F4" mask="url(#path-19-inside-3_2063_31713)" />
        <path fill-rule="evenodd" clip-rule="evenodd"
            d="M155.912 147.051C154 144.058 152.343 141.368 150.941 138.979C148.837 135.396 145.144 133.351 144.405 138.594C143.913 142.089 144.417 147.315 145.919 154.271L149.275 168.274L153.155 170.415L158.816 168.881L162.532 156.73L155.912 147.051Z"
            fill="${colorsTheens.bone_blak_theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
        <path fill-rule="evenodd" clip-rule="evenodd"
            d="M167.94 184.395C167.645 179.251 167.497 175.068 167.497 171.847C167.497 167.015 168.741 153.098 164.502 146.962C160.03 140.489 154.218 137.226 154.819 142.669C155.106 145.257 156.434 149.933 156.614 154.307C156.812 159.132 155.836 163.591 155.581 164.479C155.094 166.174 153.117 168.315 151.655 164.889C150.192 161.464 146.168 153.277 144.889 149.175C143.611 145.074 143.048 143.826 142.527 142.362C142.007 140.897 138.605 136.066 137.119 142.362C135.633 148.657 137.712 156.709 138.811 160.695C139.911 164.682 141.459 175.901 140.196 184.977C139.354 191.028 148.602 190.834 167.94 184.395Z"
            fill="${colorsTheens.bone_theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
        <path fill-rule="evenodd" clip-rule="evenodd"
            d="M150.969 200.092C147.952 203.338 139.764 201.09 138.111 197.529C136.73 194.434 137.544 187.091 140.359 183.202C143.549 178.796 148.073 179.322 149.111 179.337C153.121 179.928 154.646 180.017 159.546 178.831C164.446 177.646 168.429 184.8 168.923 186.124C169.417 187.448 171.177 196.384 167.091 199.89C164.771 201.88 159.077 202.356 156.768 200.251C154.426 198.117 152.511 198.433 150.969 200.092Z"
            fill="${colorsTheens.theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
</svg>`,

  4: `
<svg viewBox="175 128 40 78" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
        d="M204.27 184.51C202.943 171.312 201.923 162.331 201.207 157.569C199.286 144.776 196.837 137.877 196.363 136.871C195.255 134.519 191.522 129.116 190.633 135.433C190.245 138.191 191.131 146.535 190.789 160.463C190.669 165.353 190.009 174.237 188.809 187.114L204.27 184.51Z"
        fill="${colorsTheens.bone_theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
  <path fill-rule="evenodd" clip-rule="evenodd"
        d="M192.229 203.346C185.151 200.247 185.921 195.732 186.674 191.483C187.428 187.233 188.5 183.073 191.216 180.418C193.932 177.763 197.907 176.347 201.905 180.418C204.058 182.611 206.715 188.037 207.449 192.949C207.725 194.798 208.133 199.876 205.024 202.218C201.106 205.168 196.196 205.084 192.229 203.346Z"
        fill="${colorsTheens.theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
</svg>`,

  5: `
<svg viewBox="220 137 40 75" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
        d="M248.571 190.594C248.461 178.996 248.169 171.007 247.696 166.627C246.267 153.387 243.652 145.907 242.742 144.185C241.201 141.269 239.878 140.329 237.582 140.086C235.881 139.906 232.984 140.909 232.413 144.294C232.066 146.348 232.658 150.288 232.536 156.111C232.46 159.751 232.751 166.243 232.585 175.588C232.527 178.835 232.291 184.48 231.875 192.523L248.571 190.594Z"
        fill="${colorsTheens.bone_theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
  <path fill-rule="evenodd" clip-rule="evenodd"
        d="M235.687 208.384C232.522 206.374 229.862 200.861 230.412 195.648C230.67 193.205 232.887 186.64 236.741 184.276C238.09 183.449 241.953 182.381 244.944 185.085C248.564 188.359 250.937 193.288 251.687 198.522C251.954 200.383 251.734 204.278 248.872 207.02C244.444 211.264 239.483 210.794 235.687 208.384Z"
        fill="${colorsTheens.theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
</svg>`,
  6: `
<svg viewBox="263 125 45 89" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
      d="M293.581 190.654C291.642 168.023 289.888 153.578 288.321 147.318C287.044 142.218 283.872 134.104 280.982 130.838C278.55 128.091 276.196 129.5 276.537 131.836C276.827 133.825 277.615 143.529 277.67 154.926C277.755 172.822 276.114 194.891 275.707 197.816C275.262 201.007 281.221 198.62 293.581 190.654Z"
      fill="${colorsTheens.bone_theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
  <path fill-rule="evenodd" clip-rule="evenodd"
      d="M280.916 183.623C282.272 182.796 285.813 181.412 288.954 183.812C292.696 186.671 296.214 192.923 296.723 199.316C297.382 207.584 295.975 210.711 292.497 213.207C291.646 213.817 287.999 215.809 283.817 214.756C280.702 213.972 274.779 209.875 274.075 207.537C272.336 201.765 275.004 193.241 275.985 190.782C277.56 186.833 279.704 184.362 280.916 183.623Z"
      fill="${colorsTheens.theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
</svg>`,
  7: `
<svg viewBox="311 130 40 80" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
      d="M336.206 189.746C335.753 179.932 334.48 168.985 332.387 156.904C329.247 138.783 320.528 134.374 319.89 138.112C319.587 139.887 321.6 146.479 322.211 153.806C322.886 161.914 320.472 191.256 321.392 193.835C322.006 195.555 326.944 194.191 336.206 189.746Z"
      fill="${colorsTheens.bone_theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
  <path fill-rule="evenodd" clip-rule="evenodd"
      d="M332.497 182.373C335.937 185.543 338.254 191.54 338.759 197.829C338.881 199.341 339.789 204.593 337.789 207.106C336.017 209.333 331.432 208.93 329.839 208.969C327.106 209.035 324.009 208.688 322.105 206.8C318.522 203.248 319.369 191.924 320.928 188.018C321.55 186.459 323.296 182.868 325.849 181.498C328.264 180.202 331.056 181.045 332.497 182.373Z"
      fill="${colorsTheens.theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
</svg>`,
  8: `
<svg viewBox="354 130 40 85" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd"
        d="M382.036 192.717C381.192 180.51 379.822 168.757 377.926 157.46C376.738 150.378 374.059 144.678 371.62 141.93C368.221 138.101 365.899 139.205 365.443 143.52C365.093 146.828 365.908 155.719 365.641 165.182C365.265 178.551 363.125 193.062 363.648 194.58C364.245 196.308 370.374 195.687 382.036 192.717Z"
        fill="${colorsTheens.bone_theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
    <path fill-rule="evenodd" clip-rule="evenodd"
        d="M368.357 182.985C369.663 182.167 373.673 180.798 376.698 183.172C377.403 183.724 381.49 186.961 382.868 192.752C384.032 197.639 386.34 211.066 384.424 212.424C381.984 214.154 366.661 214.073 363.703 211.827C362.513 210.924 361.665 206.324 361.789 201.577C361.928 196.266 363.133 190.771 363.408 190.064C364.925 186.159 367.19 183.716 368.357 182.985Z"
        fill="${colorsTheens.theen}" stroke="${colorsTheens.colorBorder}" stroke-width="0.939136" />
</svg>`
};


//this function is for transform the teeth basic for create all the mouth
function reflect_tooth(svg, ejeX = true, ejeY = false) {
  let transform = '';
  if (ejeX) transform += ' scale(-1,1)';
  return svg.replace('<svg ', `<svg transform="${transform}" `);
}

//-----------------all the theeth of the mouth------------------
//create the fist 8 teeth of the mouth 
const svgsDientes = { ...svgsDientesPruebas };

// teeth top left (9-16)
for (let i = 1; i <= 8; i++) {
  svgsDientes[i + 8] = reflect_tooth(svgsDientesPruebas[9-i], true, false);
}

// Lower right teeth (25-32)
for (let i = 1; i <= 8; i++) {
  svgsDientes[i + 24] = reflect_tooth(svgsDientesPruebas[9-i], false, true);
}

// Lower left teeth (17-24)
for (let i = 1; i <= 8; i++) {
  svgsDientes[i + 16] = reflect_tooth(svgsDientesPruebas[i], true, true);
}



const arcadaSuperior = document.getElementById('arcada-superior');
const arcadaInferior = document.getElementById('arcada-inferior');
const panelInfo = document.getElementById('panel-info');
const tituloDiente = document.getElementById('titulo-diente');
const descripcionDiente = document.getElementById('descripcion-diente');





window.arcadaSuperior=arcadaSuperior;
window.arcadaInferior=arcadaInferior;
window.panelInfo=panelInfo;
window.tituloDiente=tituloDiente;
window.descripcionDiente=descripcionDiente;
window.svgsDientes=svgsDientes;
window.dientes=dientes;


// ===== CREATE THEETH =====
dientes.forEach(diente => {
  const div = document.createElement('div');
  div.classList.add('diente');
  div.title = diente.nombre;

  const num = document.createElement('div');
  num.classList.add('numero-diente');
  num.textContent = diente.id;
  div.appendChild(num);

  const dibujo = crearDibujoDiente(diente.id);
  div.appendChild(dibujo);

  div.addEventListener('click', () => mostrarInfo(diente, div));

  if (diente.id <= 16) arcadaSuperior.appendChild(div);
  else arcadaInferior.appendChild(div);
});

})();





// ===== FUNCIONES =====
function crearDibujoDiente(id) {
  const container = document.createElement('div');
  container.classList.add('diente-container');

  // Insertar el SVG correspondiente
  container.innerHTML = svgsDientes[id] || '<div>Diente no disponible</div>';

  return container;
}

function mostrarInfo(diente, div) {
  document.querySelectorAll('.diente').forEach(d => d.classList.remove('activo'));
  div.classList.add('activo');

  // Limpiar y obtener nueva información
  get_data_theen(diente.id);
  panelInfo.classList.remove('hidden');
  if(window.innerWidth <= 768) panelInfo.classList.add('visible');
}




















// ===== NUEVA FUNCIÓN =====
function get_data_theen(dienteId) {
  const panel = document.getElementById('panel-info');

  panel.innerHTML = `
<div class="info-diente">
  <center><h2>Diente ${dienteId}</h2></center>

  
  <div class="row">
    <div class="col">
        <!-- ESQUEMA CIRCULAR -->
        <div class="esquema-diente-circular">
            <div class="cara cuadrante" data-cara="superior-izq" title="Mesial"></div>
            <div class="cara cuadrante" data-cara="superior-der" title="Distal"></div>
            <div class="cara cuadrante" data-cara="inferior-izq" title="Vestibular"></div>
            <div class="cara cuadrante" data-cara="inferior-der" title="Lingual"></div>
            <div class="cara centro" data-cara="oclusal" title="Oclusal"></div>
        </div>
    </div>
    <div class="col">
        <!-- profundidad caries -->
        <div class="esquema-caries-rect">
            <div class="caries-barra">
                <div class="caries-nivel" data-nivel="pulpar" title="Pulpar">4</div>
                <div class="caries-nivel" data-nivel="profunda" title="Profunda">3</div>
                <div class="caries-nivel" data-nivel="media" title="Media">2</div>
                <div class="caries-nivel" data-nivel="superficial" title="Superficial">1</div>
            </div>
        </div>
    </div>
  </div>





  <!-- Estado general -->
  <div class="estado-general">
    <h3>Estado del diente</h3>
    <select id="estado-${dienteId}">
      <option value="sano">Sano</option>
      <option value="caries">Caries</option>
      <option value="restaurado">Restaurado</option>
      <option value="endodoncia">Endodoncia</option>
      <option value="extraido">Extraído</option>
    </select>
  </div>

  <!-- Detalle por cara -->
  <div class="detalle-caras">
    <h3>Detalle por cara</h3>
    <div class="cara-detalle">
      <label>Mesial</label>
      <select id="cara-mesial-${dienteId}">
        <option value="sano">Sano</option>
        <option value="caries">Caries</option>
        <option value="restaurado">Restaurado</option>
        <option value="fractura">Fractura</option>
      </select>
    </div>
    <div class="cara-detalle">
      <label>Distal</label>
      <select id="cara-distal-${dienteId}">
        <option value="sano">Sano</option>
        <option value="caries">Caries</option>
        <option value="restaurado">Restaurado</option>
        <option value="fractura">Fractura</option>
      </select>
    </div>
    <!-- Repetir Vestibular, Lingual, Oclusal -->
  </div>

  <!-- Encía / tejido -->
  <div class="tejido">
    <h3>Encía / tejido</h3>
    <label>Encía:</label>
    <select id="encia-${dienteId}">
      <option value="normal">Normal</option>
      <option value="inflamada">Inflamada</option>
      <option value="sangrado">Sangrado</option>
    </select>
    <label>Placa / sarro:</label>
    <select id="placa-${dienteId}">
      <option value="no">No</option>
      <option value="si">Sí</option>
    </select>
    <label>Movilidad:</label>
    <select id="movilidad-${dienteId}">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>
  </div>

  <!-- Observaciones -->
  <div class="observaciones">
    <h3>Observaciones</h3>
    <textarea id="obs-${dienteId}" placeholder="Notas adicionales..."></textarea>
  </div>
</div>
  `;

  // Añadir interacción visual (clic para resaltar zonas)
  panel.querySelectorAll('.cara').forEach(cara => {
    cara.addEventListener('click', () => {
      cara.classList.toggle('activa');
    });
  });

document.querySelectorAll('.caries-nivel').forEach(nivel => {
  nivel.addEventListener('click', () => {
    const niveles = Array.from(document.querySelectorAll('.caries-nivel'));
    const index = niveles.indexOf(nivel);

    // Si la capa ya estaba activa → deseleccionamos todo
    if (nivel.classList.contains('activa')) {
      niveles.forEach(n => {
        n.classList.remove('activa');
        n.classList.remove('infectada');
      });
      return;
    }

    // Limpiar estados previos
    niveles.forEach(n => {
      n.classList.remove('activa');
      n.classList.remove('infectada');
    });

    // Activar la capa clickeada
    nivel.classList.add('activa');

    // Marcar capas por debajo como infectadas
    for (let i = index + 1; i < niveles.length; i++) {
      niveles[i].classList.add('infectada');
    }

    // Las capas por encima vuelven a normal
    for (let i = 0; i < index; i++) {
      niveles[i].classList.remove('infectada');
      niveles[i].classList.remove('activa');
    }
  });
});
}

// Ocultar panel si toca fuera en móvil
window.addEventListener('click', e => {
  if(window.innerWidth <= 768 &&
     !panelInfo.contains(e.target) &&
     !e.target.classList.contains('diente')) {
    panelInfo.classList.remove('visible');
  }
});
</script>