<message-pop name="form-folder" title="files.title.folder">
    <div class="upload-card">
        <form id="folderForm">
            <input type="hidden" name="folder_father_id" id="folder_father_id_folder">
            <input type="hidden" id="folder_id">
            <div class="section">
                <input-field label="files.label.name-folder" placeholder="files.placeholder.name-folder"
                    name="name" id="folder_name"></input-field>
            </div>
            <label t="files.label.folder-color"></label>
            <input-color id="folder_color" name="color"></input-color>
            <br>
            <button type="button" class="btn btn-edit btn-success" t="btn.save" onclick="send_form_of_the_folder()"></button>
        </form>
    </div>
</message-pop>

<script>
    function update_container_folder(){
        //this functions is for update the container of the folders and files when the user is in the home
        if (typeof get_div_folders === "function"){
            window.update_container_from_the_server(
                ['search-folders', 'path_folder_id1'], 
                'container-folders', 
                get_div_folders(), 
                'files/view_folders_of_the_folder/', 
                'GET'
            )
        }
    }

    function update_container_files(){
        //this functions is for update the container of the folders and files when the user is in the home
        if (typeof get_div_files === "function"){
            window.update_container_from_the_server(
                ['search-files', 'path_folder_id2'], 
                'container-file', 
                get_div_files(), 
                'files/view_files_of_the_folder/', 
                'GET'
            )
        }
    }

    function open_pop_create_new_folder(){
        window.restart_form('folderForm'); //clear the form
        document.getElementById('folder_color').updateColor('#085DA9');
        window.show_pop('form-folder')
    }

    async function save_new_folder(){
        //we will send the form to the server for save the new folder
        const folderFatherElement = document.getElementById('path_folder_id1');
        document.getElementById('folder_father_id_folder').value = folderFatherElement?.value || '';

        const backend=await window.send_form_to_the_server('folderForm', `files/create_new_folder/`);
        if(!backend.success){
            window.show_alert('error', 'error.general', backend.message || 'error.general-description', backend.error || '');
            return;
        }

        //if we can added the new folder now restart the form and show a message of confirm
        window.restart_form('folderForm');
        window.hide_pop('form-folder');
        window.show_alert('success', 'files.title.folder-create','files.message.folder-create', backend.error || '');
        update_container_folder();
    }

    async function update_folder(){
        const folder_id=document.getElementById('folder_id');
        if(!folder_id || folder_id.value.trim() == ''){
            window.show_alert('alert', 'error.general', 'files.message.folder-id-not-exit', backend.error || '');
        }

        //we will send the form to the server for save the new folder
        const backend=await window.send_form_to_the_server('folderForm', `files/edit_folder/${folder_id.value}/`);
        if(!backend.success){
            window.show_alert('error', 'error.general', backend.message || 'error.general-description', backend.error || '');
            return;
        }

        //if we can added the new folder now restart the form and show a message of confirm
        window.restart_form('folderForm');
        window.hide_pop('form-folder');
        window.show_alert('success', 'files.title.the-folder-was-update', 'files.message.the-folder-was-update', backend.error || '');
        update_container_folder();
    }

    async function send_form_of_the_folder(){
        //first we will see if exist a folder for edit
        const folderInput=document.getElementById('folder_id');
        if(folderInput && folderInput.value.trim() == ''){
            await save_new_folder();
        }else{
            await update_folder();
        }
    }

    async function open_pop_edit_folder(folder_id){
        //this functions is for get the information of a folder by his id from the database
        const backend=await window.send_message_to_the_server(`files/get_information_folder/${folder_id}/`, {}, true, 'GET');
        if(!backend.success){
            window.show_alert('error', 'error.general', backend.message || 'files.message.not-can-get-the-information-of-the-folder', backend.error || '');
        }


        //if can get the information of the folder now we will to show in screen
        const answer=backend.answer;
        document.getElementById('folder_id').value=answer.id;
        document.getElementById('folder_name').value=answer.name;
        document.getElementById('folder_color').updateColor(answer.color || '#1649FF');
        window.show_pop('form-folder');
    }
</script>