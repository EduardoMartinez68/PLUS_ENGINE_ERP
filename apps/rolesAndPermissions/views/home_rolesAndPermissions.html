<style>

.search-container {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  padding: 6px 6px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  background-color: white;
}

</style>

{% include 'partials_rolesAndPermissions/navbarHome.html' %}

<div class="container-section">


<div class="search-container">
  <i class="fi fi-rs-search search-icon"></i>
  <input type="text" class="search-input" t-placeholder="message.search" id="seacrh">
</div>


<table class="section">
    <thead>
        <tr>
            <th style="width: 30%;">Nombre del Rol</th>
            <th style="width: 80%;">Descripción</th>
            <th style="width: 10%;"></th>
        </tr>
    </thead>
    <tbody id="table-role">
        <tr>
            <td>Administrador</td>
            <td>Puede gestionar usuarios, roles y todos los permisos del sistema.</td>
            <td>
                <button onclick="editRole('Administrador')" class="btn btn-transparent"><i class="fi fi-sr-pencil"></i></button>
                <button onclick="deleteRole('Administrador')" class="btn btn-transparent"><i class="fi fi-sr-trash"></i></button>
            </td>
        </tr>
        <tr>
            <td>Doctor</td>
            <td>Gestiona pacientes, historiales médicos y citas médicas.</td>
            <td>
                <button onclick="editRole('Doctor')">Editar</button>
                <button onclick="deleteRole('Doctor')">Eliminar</button>
            </td>
        </tr>
        <tr>
            <td>Recepcionista</td>
            <td>Gestiona citas y la información básica de los pacientes.</td>
            <td>
                <button onclick="editRole('Recepcionista')">Editar</button>
                <button onclick="deleteRole('Recepcionista')">Eliminar</button>
            </td>
        </tr>
        <tr>
            <td>Contador</td>
            <td>Acceso a facturación, pagos y reportes financieros.</td>
            <td>
                <button onclick="editRole('Contador')">Editar</button>
                <button onclick="deleteRole('Contador')">Eliminar</button>
            </td>
        </tr>
    </tbody>
</table>
</div>

<script>
    (()=>{
        const divHtml=`
            <tr>
                <td> { name } </td>
                <td> { description } </td>
                <td>
                    <button onclick="edit_role(' { id } ')" class="btn btn-transparent"><i class="fi fi-sr-pencil"></i></button>
                    <button onclick="delete_role(' { id } ')" class="btn btn-transparent"><i class="fi fi-sr-trash"></i></button>
                </td>
            </tr>
        `
        update_container_with_seeker('seacrh', 'table-role', divHtml, 'rolesAndPermissions/get_information_of_the_role', 'GET');
    })();


    async function edit_role(rol_id){
        rol_id = String(rol_id).trim();
        await nextWeb(`rolesAndPermissions/edit_rol/${rol_id}/`);
    }

    async function delete_role(role_id){
        if(await show_message_question('rolesAndPermissions.message.question.title.do-you-like-delete-this-role', 'rolesAndPermissions.message.question.description.do-you-like-delete-this-role')){
            role_id = String(role_id).trim();
            const backend=await send_message_to_the_server('rolesAndPermissions/delete_rol/', {role_id:role_id}, true);
            if(backend.success){
                const divHtml=`
                    <tr>
                        <td> { name } </td>
                        <td> { description } </td>
                        <td>
                            <button onclick="edit_role(' { id } ')" class="btn btn-transparent"><i class="fi fi-sr-pencil"></i></button>
                            <button onclick="delete_role(' { id } ')" class="btn btn-transparent"><i class="fi fi-sr-trash"></i></button>
                        </td>
                    </tr>
                `
                update_container_from_the_server('seacrh', 'table-role', divHtml, 'rolesAndPermissions/get_information_of_the_role', 'GET'); //update the table
                show_alert('success', 'rolesAndPermissions.message.success.title.the-rol-was-deactivated','rolesAndPermissions.message.success.the-rol-was-deactivated', backend.error || '');
            }else{
                show_alert('error', 'Error', backend.message || 'rolesAndPermissions.message.error.unexpected-error', backend.error || '');
            }
        }
    }
</script>