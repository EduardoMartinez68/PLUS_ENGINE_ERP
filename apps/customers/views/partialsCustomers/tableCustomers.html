

<!---this is the pop for filter the customer that the user would like search---->
<message-pop title="title-filter" name="pop-filter-customer">
    <div class="row">
        <div class="col">
            <plus-select label="select-type-customer">
            </plus-select>
        </div>
        <div class="col">
            <plus-select label="select-priority">
                <option value="" t="select-priority-0"></option>
                <option value="" t="select-priority-1"></option>
                <option value="" t="select-priority-2"></option>
                <option value="" t="select-priority-3"></option>
                <option value="" t="select-priority-all"></option>
            </plus-select>
        </div>
        <div class="col">
            <plus-select label="select-type-customer">
                <option value="" t="option-status-activated">Activate</option>
                <option value="" t="option-status-deleted">Delete</option>
                <option value="" t="option-status-all">All</option>
            </plus-select>
        </div>
    </div>

    <button t="message.success" class="btn btn-edit btn-success" onclick="filter_the_customer()">Search</button>
</message-pop>



<!---show the table of the customers and his information--->
{% load static %}
<style>
/* === Tarjeta principal === */
.info-customer-card {
  padding: 28px 32px;
  border-radius: 20px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.02);
  margin: 20px auto;
  transition: all 0.3s ease;
  width: 100%;
}

/* === Encabezado del cliente === */
.customer-header {
  display: flex;
  align-items: center;
  gap: 18px;
  margin-bottom: 28px;
  border-bottom: 2px solid #f0f0f5;
  padding-bottom: 20px;
}

.customer-avatar {
  width: 90px;
  height: 90px;
  border-radius: 10%;
  object-fit: cover;
  border: 4px solid #e6ebf2;
}

.customer-header h2 {
  margin: 0;
  font-size: 1.6rem;
  font-weight: 700;
  color: #1c1e21;
}

.status {
  margin-left: auto;
  padding: 6px 16px;
  border-radius: 50px;
  font-size: 0.9rem;
  font-weight: 600;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

.status.active {
  background: #e6f9f0;
  color: #219150;
  border: 1px solid #a8e5c1;
}

.status.inactive {
  background: #fdecec;
  color: #d93025;
  border: 1px solid #f5b9b9;
}

/* === Detalles del cliente === */
.customer-details {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 18px 24px;
  margin-top: 10px;
}

.customer-details .detail-box {
  background: #ffffff;
  border: 1px solid #f0f2f6;
  border-radius: 14px;
  padding: 14px 16px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.04);
  transition: all 0.2s ease;
}

.customer-details .detail-box:hover {
  background: #f8faff;
  border-color: #d9e4f5;
}

.detail-label {
  font-size: 0.75rem;
  color: #6b7280;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 4px;
  display: block;
}

.detail-value {
  font-size: 1rem;
  font-weight: 600;
  color: #1f2937;
  line-height: 1.4;
}

/* === Mensaje de error elegante === */
.error-message {
  background: #fff2f2;
  color: #b91c1c;
  padding: 16px;
  border-radius: 14px;
  text-align: center;
  font-weight: 600;
  border: 1px solid #f5c2c2;
}


.stars {
    color: #FFD700; /* amarillo brillante para estrellas */
    font-size: 1.4rem;
}

.star.filled {
    color: #FFD700;
}

.star {
    color: #ccc;
}

.status-points {
    display: flex;
    gap: 10px; /* Espacio entre tags */
    margin: 10px 0;
    font-weight: 500;
    align-items: center;
}

/* Estilo común para los tags */
.status-points span {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 20px; /* Redondeado completo */
    font-size: 0.7rem;
    font-weight: 600;
    color: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

/* Tag de puntos */
.status-points .points {
    background: #4c7faf; /* Verde agradable */
}

/* Tag de crédito */
.status-points .credit {
    background: #798ebb; /* Naranja cálido */
}

.customers-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  width: 100%;
}

.container-padding {
  padding-top: 0px;
  padding-right: 30px;
  padding-bottom: 0px;
  padding-left: 30px;
}
</style>






<script>
  function render_stars(priority) {
        let stars = '';
        const maxStars = 3;
        for (let i = 1; i <= maxStars; i++) {
            if (i <= priority) {
                stars += '<span class="star filled">★</span>';
            } else {
                stars += '<span class="star">☆</span>';
            }
        }
        return stars;
    }

  async function update_information_div_customer(id_customer){
    //this function is for update the div information use the information that the user selected 
    const answer=await send_message_to_the_server('/customers/get_information_of_the_customer/', {id_customer}, true, 'GET');
    if(answer.success){
        //if get a answer of the server, we will get his data and update the div <info-customer> with all the information of the server
        const data=answer.answer;

        // Render dinámico con template literal
        const container = document.getElementById('info-customer');
        container.innerHTML = ""; //clear the container
        container.innerHTML = `
        <div class="info-customer-card">
            <div class="customer-header section">
                <img src="${data.avatar}" alt="Foto de ${data.name}" class="customer-avatar">
                <div>
                    <h2>${data.name}</h2>
                    <br>
                    <span class="detail-value stars">${render_stars(data.priority)}</span>
                    <br>
                    <div class="status-points">
                        <span class="points">${data.points} pts</span>
                        <span class="credit">$${data.credit}</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <span class="detail-label">Email</span>
                <span class="detail-value">${data.email}</span>
            </div>

            <div class="customer-details">
                <div class="detail-box">
                    <span class="detail-label">Celular</span>
                    <span class="detail-value">${data.cellphone}</span>
                </div>
                <div class="detail-box">
                    <span class="detail-label">Teléfono</span>
                    <span class="detail-value">${data.phone}</span>
                </div>


                
            </div>
            <br>
            <show-more text='Numero de precio' description='1'></show-more>
            <br>
            <show-more text='Domicilio' description='(San Luis Potosi. Mexico.)'></show-more>
            <br>
            <div class="row">
                <div class="col-8 d-flex justify-content-start">
                    <button class="btn btn-edit btn-success">Editar</button>
                </div>
                <div class="col-4 d-flex justify-content-end">
                    <button class="btn btn-delete btn-success"><i class="fi fi-sr-trash"></i></button>
                </div>
            </div>
        </div>
        `;
    }else{
        //if not can get the information of the customer, we will show a pop error and clear the div <info-customer>
      document.getElementById('info-customer').innerHTML = `
        <div class="error-message">
          <img src="{% static 'img/customer_home.webp' %}" alt="Customer Home">
          <h3 t="dashboard-no-customer-selected">No customer selected</h3>
        </div>
      `;
    }


    window.toggle_switch_column('customers-switch'); //show the div that is hidden if the user is in cellphone
  }


</script>





































<script>
    async function filter_the_customer(){
        hide_pop('pop-filter-customer')
    }
</script>


<script>
    if (!customElements.get("plus-customers")) {
    class PlusCustomers extends HTMLElement {
        constructor() {
            super();
            this.attachShadow({ mode: "open" });
        }

        connectedCallback() {
            if (this._rendered) return;
            this._rendered = true;

            // atributos recibidos
            const customerId = this.getAttribute("customer-id") || "";
            const name = this.getAttribute("name") || "Sin nombre";
            const email = this.getAttribute("email") || "Sin email";
            const phone = this.getAttribute("phone") || "Sin celular";
            const tag = this.getAttribute("tag") || "General";
            const points = this.getAttribute("points") || "0";
            const credit = this.getAttribute("credit") || "0";
            const image = this.getAttribute("image") || "https://via.placeholder.com/80";
            const status = this.getAttribute("status") || "active"; // active | inactive
            const priority = parseInt(this.getAttribute("priority")) || 0; // 0-3

            // estilos
            const style = document.createElement("style");
            style.textContent = `
      .card-customer {
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        gap: 10px;
        transition: all 0.3s ease-in-out;
        width:100%;
      }

      .card-customer:hover{
        cursor:pointer;
      }

      .card-customer.inactive {
        opacity: 0.6;
        filter: grayscale(60%);
      }

      .customer-header {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .customer-img {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #e5e7eb;
      }

      .customer-name {
        font-size: 1.2rem;
        font-weight: bold;
        color: #111827;
        margin: 0;
      }

      .customer-info {
        font-size: 0.9rem;
        color: #374151;
      }

      .customer-tag {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 12px;
        background-color: var(--tag-color, #3B82F6);
        color: var(--tag-text-color, #ffffff);       
        font-size: 0.8rem;
        font-weight: 500;
        margin-top: 4px;
        width: auto;          
        max-width: 100px;
        text-align: center;   
      }

      .customer-stats {
        display: flex;
        justify-content: space-between;
        font-size: 0.9rem;
        margin-top: 8px;
      }

      .customer-stat {
        background: #f9fafb;
        padding: 6px 10px;
        border-radius: 8px;
      }

      .priority {
        display: flex;
        gap: 4px;
        font-size: 1.2rem;
        margin-top: 6px;
      }

      .star {
        color: #d1d5db; 
      }

      .star.filled {
        color: #fbbf24; 
        text-shadow: 0px 2px 6px rgba(0,0,0,0.15);
      }
    `;

            // generar estrellas según prioridad
            const renderStars = () => {
                let starsHTML = "";
                for (let i = 1; i <= 3; i++) {
                    starsHTML += `<span class="star ${i <= priority ? "filled" : ""}">★</span>`;
                }
                return starsHTML;
            };

            // estructura HTML
            const wrapper = document.createElement("div");
            wrapper.classList.add("card-customer");
            if (status === "inactive") wrapper.classList.add("inactive");


            wrapper.innerHTML = `
      <div class="customer-header">
        <img class="customer-img" src="${image}" alt="${name}">
        <div>
          <p class="customer-name">${name}</p>
          <div class="customer-info">${email}</div>
          <div class="customer-info">${phone}</div>
        </div>
      </div>
      <span class="customer-tag">${tag}</span>
      <div class="priority">${renderStars()}</div>
      <div class="customer-stats">
        <div class="customer-stat" t='card-points'>${window.translate_text('card-points')}: ${points}</div>
        <div class="customer-stat" t='card-credit'>${window.translate_text('card-credit')}: $${credit}</div>
      </div>
      <input type="hidden" name="customer_id" value="${customerId}">
    `;

            this.shadowRoot.append(style, wrapper);

            const onClickFunction = this.getAttribute("onclick") || null;
            if (onClickFunction) {
                wrapper.style.cursor = "pointer"; // opcional: mostrar que es clickable
                wrapper.addEventListener("click", () => {
                    if (typeof window[onClickFunction] === "function") {
                        window[onClickFunction]();
                    }
                });
            }
        }
    }

    customElements.define("plus-customers", PlusCustomers);
    }
</script>
<script>
(() => {
  const divHtml = `
    <plus-customers 
    id-customer="{ id }" 
    name="{ name }" 
    email="{ email }" 
    phone="{ phone }"
    tag="{ tag }" 
    points="{ points }" 
    credit="{ credit }" 
    priority="{ priority }"
    image="{ avatar }"
    status="{ status }"
    onclick="update_information_div_customer('{ id }')">
    </plus-customers>
  `;

  update_container_with_seeker(
    'search-customer',
    'customer-list',
    divHtml,
    '/customers/customers_search',
    'GET'
  );


})();
</script>