<style>
  .calendary-week-calendar {
    display: grid;
    grid-template-columns: 100px repeat(7, 1fr);
    width: 100%;
    height: 100vh;
    position: relative;
    overflow-x: auto; /* permitir scroll horizontal en móviles */
  }


  .calendary-week-header {
    display: contents;
  }

  .calendary-week-header div {
    background: #f0f0f0;
    text-align: center;
    padding: 10px;
    font-weight: bold;
    border: 1px solid #ccc;
  }

  .calendary-week-hour-cell {
    padding: 4px;
    border: 1px solid #ddd;
    text-align: right;
    font-size: 12px;
    background: #fafafa;
  }

  .calendary-week-time-slot {
    border: 1px solid #eee;
    height: 40px;
    position: relative;
  }

  .calendary-week-row {
    display: contents;
  }

  .calendary-week-column-day {
    background: #fff;
  }

  /* 🔴 Línea roja para hora actual */
  .calendary-week-current-hour-line {
    position: absolute;
    height: 2px;
    background: rgb(250, 126, 126);
    width: calc(100% - 100px); /* 100px es la columna de horas */
    left: 100px;
    z-index: 10;
  }

  /* 🌟 Columna del día actual */
  .calendary-week-today-column {
    background-color: #e0f7fa79 !important;
  }

  /* 📱 Adaptación a móviles */
  @media (max-width: 768px) {
    .calendary-week-calendar {
      grid-template-columns: 60px repeat(7, minmax(60px, 1fr));
    }

    .calendary-week-header div {
      font-size: 10px;
      padding: 6px 2px;
    }

    .calendary-week-hour-cell {
      font-size: 8px;
      padding: 1px 2px;
    }

    .calendary-week-time-slot {
      height: 30px;
    }

    .calendary-week-current-hour-line {
      width: calc(100% - 60px);
      left: 60px;
    }
  }

  @media (max-width: 480px) {
    .calendary-week-calendar {
      grid-template-columns: 40px repeat(7, minmax(40px, 1fr));
    }

    .calendary-week-header div {
      font-size: 8px;
      padding: 4px 1px;
    }

    .calendary-week-hour-cell {
      font-size: 7px;
      padding: 1px;
    }

    .calendary-week-time-slot {
      height: 25px;
    }

    .calendary-week-current-hour-line {
      width: calc(100% - 40px);
      left: 40px;
    }
  }
</style>

<div id="calendary-week-calendar" class="calendary-week-calendar"></div>

<script>
  function renderWeek(dateStr) {
    const calendar = document.getElementById('calendary-week-calendar');
    calendar.innerHTML = '';

    const inputDate = new Date(dateStr);
    const weekStart = new Date(inputDate);
    weekStart.setDate(inputDate.getDate() - inputDate.getDay()); // Sunday

    const today = new Date();
    const isSameDay = (d1, d2) =>
      d1.getFullYear() === d2.getFullYear() &&
      d1.getMonth() === d2.getMonth() &&
      d1.getDate() === d2.getDate();

    const header = document.createElement('div');
    header.className = 'calendary-week-header';

    const hourHeader = document.createElement('div');
    hourHeader.textContent = '';
    header.appendChild(hourHeader);

    // Here we will get the days of the week in the language that the user uses
    const dayNames = [window.t('sunday'), window.t('monday'), window.t('tuesday'), window.t('wednesday'), window.t('thursday'), window.t('friday'), window.t('saturday')];

    const todayColumnIndices = [];

    for (let i = 0; i < 7; i++) {
      const day = new Date(weekStart);
      day.setDate(weekStart.getDate() + i);

      const dayDiv = document.createElement('div');
      dayDiv.textContent = `${dayNames[i]} ${day.getDate()}`;

      if (isSameDay(today, day)) {
        todayColumnIndices.push(i); // save here the day that is today
        dayDiv.style.backgroundColor = '#e0f7fa'; // also highlight in header
      }

      header.appendChild(dayDiv);
    }

    calendar.appendChild(header);

    for (let h = 0; h < 24; h++) {
      const hour = h.toString().padStart(2, '0');

      const row = document.createElement('div');
      row.className = 'calendary-week-row';

      const hourCell = document.createElement('div');
      hourCell.className = 'calendary-week-hour-cell';
      hourCell.textContent = `${hour}:00`;
      row.appendChild(hourCell);

      for (let d = 0; d < 7; d++) {
        const slot = document.createElement('div');
        slot.className = 'calendary-week-time-slot calendary-week-column-day';
        slot.dataset.day = d;
        slot.dataset.hour = h;

        // Si esta es la columna del día actual, le añadimos la clase de fondo
        if (todayColumnIndices.includes(d)) {
          slot.classList.add('calendary-week-today-column');
        }

        row.appendChild(slot);
      }

      calendar.appendChild(row);
    }

    // 🔴 Línea roja de la hora actual
    if (today >= weekStart && today <= new Date(weekStart.getTime() + 6 * 86400000)) {
      const hours = today.getHours();
      const minutes = today.getMinutes();
      const positionY = (hours * 40) + (minutes / 60 * 40); // cada hora es 40px

      const redLine = document.createElement('div');
      redLine.className = 'calendary-week-current-hour-line';
      redLine.style.top = `${positionY + 40}px`; // +40 por el encabezado de días

      calendar.appendChild(redLine);
    }
  }

  function render_this_day() {
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    const todayStr = `${yyyy}-${mm}-${dd}`;

    renderWeek(todayStr);
  }

  render_this_day();



  async function get_the_information_of_the_calendary(){
    //first we will get the range of date that need get
    
    const response = await send_message_to_the_server('/agenda/get_info_calendary_week/', {}, false, 'GET');
    if (response.success) {
      console.log('Información del calendario semanal:', response.data);
    } else {
      console.error('Error al obtener la información del calendario:', response.error);
    }
  }
</script>
