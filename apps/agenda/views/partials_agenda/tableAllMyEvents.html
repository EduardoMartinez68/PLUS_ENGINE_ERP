<style>
    .badge-type {
        display: inline-block;
        padding: 4px 12px;
        font-size: 13px;
        font-weight: 600;
        border-radius: 20px;   /* m치s redondeado estilo "tag" */
        border: 1px solid rgba(0,0,0,0.1); /* sutil borde */
        text-transform: capitalize;
        white-space: nowrap;
        transition: all 0.2s ease-in-out;
        color: rgba(0,0,0,0.8);
    }

    .btn-add-f {
    color: white;
    font-size: 22px;
    font-weight: 400;
    border: none;
    border-radius: 8px; /* esquinas suaves */
    width: 45px;
    height: 45px;
    cursor: pointer;
    margin-top: 15px; /* lo baja m치s */
    transition: background 0.3s ease;
    }


    table{
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        border-collapse: collapse;
    }

    table th,
    table td {
        padding: 8px 12px;
        text-align: left;
        white-space: nowrap; /* evita que se rompan los textos */
    }
</style>
{% load static %}

<message-pop title="title.show-all-my-appoints" name="pop-show-all-my-events" style="width: 80%;">
    <div class="row">
        <div class="col-10">
            <search-bar placeholder="search.seacrh-all-my-events" function-callback="filter_table_appoints" id="input-search-all-my-event"></search-bar>
        </div>
        <div class="col-2 text-center">
            <button class="btn-add btn-add-f" onclick="open_type_pop()">+</button>
        </div>
    </div>

    <div class="row">
        <table id="table-my-events">
            <thead>
                <tr>
                    <th t="table-events-title" style="width:15%;">Title</th>
                    <th t="table-events-description" style="width:20%;">Descripci칩n</th>
                    <th t="table-events-date-start" style="width:15%;">Inicio</th>
                    <th t="table-events-date-finish" style="width:15%;">Finish</th>
                    <th t="table-events-type-event" style="width:10%;">Type event</th>
                    <th t="table-events-priority" style="width:5%;">Prioridad</th>
                    <th t="table-events-ubication" style="width:10%;">Ubicaci칩n</th>
                    <th style="width:5%;"></th>
                    <th style="width:5%;"></th>
                </tr>
            </thead>
            <tbody id="body-table-my-events">

            </tbody>
        </table>
    </div>
</message-pop>


<script>
    function filter_table_appoints(text){
        //here we will see if the pop is visible for the user, if not is visible, we not need update the information
        const table = document.getElementById('table-my-events');
        if(table && table.offsetParent !== null){
            const divHtml = `
                <td> { title } </td>
                <td>{ description } </td>
                <td> { date_start } </td>
                <td> { date_finish } </td>
                <td><span class="badge-type" style="background-color: ' { type_appoint_color } ';">{ type_appoint_name }</span></td>
                <td> { priority } </td>
                <td>{ location }</td>
                <td>
                    <button class="btn btn-transparent" onclick='show_character_appoint( { id } )'><i class="fi fi-sr-pencil"></i></button>
                </td>
                <td>
                    <button class="btn btn-transparent" onclick="delete_event( { id } )"><i class="fi fi-sr-trash"></i></button>
                </td>
            `

            window.update_container_with_seeker(
                ['input-search-all-my-event'], // id of the input of the seeker
                'body-table-my-events',  // id of the container to update
                divHtml,            // template with placeholders
                'agenda/search_events/', // url for the search
                'GET'
            );
        }  
    }

    async function delete_event(id){
        if (await show_message_question('question.delete-event', 'question.delete-event-description')) {
            const answer=await window.send_message_to_the_server('/agenda/delete_event/',{id_event: id})
            if (answer.success) {

                //create a metod for that the script not have a error if the web not can load all the script
                if (typeof update_all_the_information_of_my_calendary === 'function') {
                    window.update_all_the_information_of_my_calendary();
                }

                filter_table_appoints('')
                show_alert('success', window.translate_text('message.delte-event-title'), window.t('message.delte-event-description'))
            } else {
                show_alert('alert', window.translate_text('message.delete-event-fail'), window.t('error.to_delete'), answer.error)
                console.error(answer.message || 'Error to delete the item in the server');
                console.error(answer.error);
            }
        }
    }
</script>
<script>
(async() => {

})();
</script>